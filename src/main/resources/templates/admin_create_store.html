<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>가게 등록 | 먹코살코</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- 파비콘 설정 -->
    <link rel="shortcut icon" th:href="@{/images/mini_logo.jpg}">
    
    <!-- 카카오맵 API -->
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=913010ecf61096ff085a9717807d98df&libraries=services"></script>
    
    <!-- Daum Postcode 서비스 -->
    <script src="https://ssl.daumcdn.net/dmaps/map_js_init/postcode.v2.js"></script>

    <!-- 메인 스타일시트 -->
    <style>
        /* 기본 리셋 및 스타일 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "맑은 고딕", sans-serif;
            background-color: #f9f9f9;
            color: #333;
            line-height: 1.6;
        }

        /* 헤더 및 내비게이션 바 전체 너비 설정 */
        .header {
            width: 100%;
            background-color: #fff; /* 배경색 */
            border-bottom: 2px solid #FF885B; /* 테두리 추가 및 색상 변경 */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* 헤더에 그림자 추가 */
            /* 고정 헤더 position: fixed;  */
            top: 0;
            left: 0;
            z-index: 600;
        }

        /* 컨테이너 스타일 */
        .container {
            max-width: 1200px;
            margin: 80px auto 0 auto;
            padding: 20px;
        }

        /* 헤더 내부 컨텐츠 정렬 */
        .header .container-inner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
        }

        /* 로고 스타일 */
        .header .logo {
            display: flex;
            align-items: center;
            margin-left: 30px;
        }

        .header .logo img {
            width: 50px;
            height: auto;
            margin-right: 10px;
        }

        .header .logo h1 {
            font-size: 24px;
            color: #FF885B;
        }

        /* 내비게이션 스타일 */
        .nav {
            display: flex;
            gap: 25px;
            position: relative;
            align-items: center;
            margin-right: 30px;
        }

        .nav a {
            text-decoration: none;
            color: #333;
            font-weight: bold;
            transition: color 0.5s;
            padding: 8px 12px;
        }

        .nav a:hover {
            color: #FF885B;
        }

        /* 드롭다운 메뉴 스타일 */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            color: #333;
            font-weight: bold;
        }

        .dropdown button:hover {
            color: #FF885B;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: #fff;
            min-width: 160px;
            box-shadow: 0px 8px 16px rgba(0,0,0,0.2);
            border: 1px solid #ddd;
            z-index: 1;
            border-radius: 5px;
        }

        .dropdown-content a {
            color: #333;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            transition: background-color 0.3s;
        }

        .dropdown-content a:hover {
            background-color: #f1f1f1;
            color: #FF885B;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        /* 메인 콘텐츠 스타일 */
        .main-content {
            width: 800px;
            margin: 75px auto; /* 상단 여백 추가 및 가운데 정렬 */
            background-color: #fff;
            padding: 30px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            margin-bottom: 100px;
        }

        .main-content h2 {
            font-size: 28px;
            color: #FF885B;
            margin-bottom: 20px;
            text-align: center;
        }

        .main-content img {
            display: block;
            margin: 0 auto 20px auto; /* 가운데 정렬 및 하단 여백 추가 */
            width: 150px; /* 원하는 크기로 조정 */
            height: auto;
        }

        .description {
            text-align: center;
            font-size: 15px;
            color: #666; 
            margin-top: 20px;
            margin-bottom: 20px;
        }

        /* 폼 요소 스타일 */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #FF885B; /* #FF885B 컬러 적용 */
        }

        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="password"],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1.5px solid #FF885B;
            border-radius: 5px;
            font-size: 16px;
            resize: none;
            box-sizing: border-box;
            font-family: "맑은 고딕", sans-serif;
        }

        .form-group textarea {
            height: 200px;
            line-height: 1.5;
        }

        /* 파일 업로드 숨기기 */
        .hidden-file-input {
            display: none;
        }

        /* 커스텀 파일 버튼 스타일 */
        .custom-file-button {
            display: inline-block;
            background-color: #FF885B;
            color: #fff;
            border: none;
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px;
            text-align: center;
            text-decoration: none;
        }

        .custom-file-button:hover {
            background-color: #e07a4d;
        }

        /* 파일명 표시 스타일 */
        .file-name {
            display: inline-block;
            margin-left: 10px;
            font-size: 14px;
            color: #333;
            vertical-align: middle;
        }

        /* 플레이스홀더 스타일 */
        textarea::placeholder {
            white-space: pre-line;
            color: #999;
        }

        /* 버튼 컨테이너 스타일 */
        .button-container {
            text-align: center;
            margin-top: 30px;
        }

        /* 버튼 스타일 */
        .button-container input[type="submit"],
        .button-container .cancel-button {
            background-color: #FF885B;
            color: #fff;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 0 10px;
        }

        /* 취소 버튼 별도 스타일 */
        .button-container .cancel-button {
            background-color: #ccc;
            color: #333;
        }

        /* 버튼 호버 효과 */
        .button-container input[type="submit"]:hover {
            background-color: #e07a4d;
        }

        .button-container .cancel-button:hover {
            background-color: #999;
        }

        /* 푸터 스타일 */
        footer {
            background-color: #FF885B;
            color: #fff;
            padding: 20px 10px;
            margin-top: 40px;
        }

        .footer-container {
            max-width: 1500px;
            height: 80%;
            width: 100%; /* 전체 너비 */
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between; 
            gap: 100px;
            padding: 10px 0px;
        }

        .footer-section {
            flex: 1 1 200px;
        }

        .footer-section h4 {
            margin-bottom: 15px;
            font-size: 18px;
            border-bottom: 2px solid #fff;
            display: inline-block;
            padding-bottom: 5px;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section ul li {
            margin-bottom: 10px;
        }

        .footer-section ul li a {
            color: #fff;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-section ul li a:hover {
            color: #e07a4d;
        }

        .social-icons {
            display: flex;
            gap: 10px;
        }

        .social-icons a img {
            width: 24px;
            height: 24px;
            filter: invert(100%);
            transition: filter 0.3s;
        }

        .social-icons a:hover img {
            filter: invert(75%) sepia(100%) saturate(500%) hue-rotate(300deg);
        }

        .footer-bottom {
            text-align: center;
            font-size: 14px;
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            padding-top: 10px;
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .header .container-inner {
                flex-direction: column;
                align-items: center;
            }

            .nav {
                flex-direction: column;
                gap: 10px;
                margin-top: 10px;
            }

            .footer-container {
                flex-direction: column;
                align-items: center;
            }

            .footer-section {
                flex: 1 1 100%;
                text-align: center;
            }

            .social-icons {
                justify-content: center;
            }

            .main-content {
                width: 90%;
                padding: 20px;
            }

            #map {
                height: 250px;
            }
        }

        @media (max-width: 480px) {
            .header .logo h1 {
                font-size: 20px;
            }

            .nav a {
                font-size: 14px;
            }

            .button-container input[type="submit"],
            .button-container .cancel-button {
                width: 100%;
                padding: 10px 0;
                font-size: 14px;
                margin: 10px 0;
            }
        }

        /* 메뉴 추가 버튼 스타일 */
        .add-menu-button {
            background-color: #FF885B;
            color: #fff;
            border: none;
            padding: 8px 16px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px;
        }

        .add-menu-button:hover {
            background-color: #e07a4d;
        }

        /* 메뉴 섹션 스타일 */
        .menu-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f1f1f1;
            position: relative;
        }

        .menu-section .remove-menu {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: #ff4d4d;
            font-size: 18px;
            cursor: pointer;
        }

        /* 우편번호 찾기 버튼 스타일 (기존과 동일) */
        .postcode-button {
            background-color: #FF885B;
            color: #fff;
            border: none;
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px;
        }

        .postcode-button:hover {
            background-color: #e07a4d;
        }

        /* 이미지 미리보기 스타일 (선택사항) */
        img {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <!-- 헤더: 로고와 네비게이션 -->
    <div class="header">
        <div class="container-inner">
            <div class="logo">
                <img th:src="@{/images/main_logo.png}" alt="Main Logo">
                <h1>먹코살코</h1>
            </div>
            <nav class="nav" id="mainNav">
                <a href="home.html">홈</a>
                <a href="intro.html">소개</a>
                <a href="contact.html">문의</a>
                <!-- 드롭다운 메뉴 추가 -->
                <div class="dropdown">
                    <button id="userMenuButton">▼</button>
                    <div class="dropdown-content" id="userMenu">
                        <!-- 로그인 전 메뉴 -->
                        <a href="#" id="loginLink">로그인</a>
                        <!-- 로그인 후 메뉴 (숨김 상태) -->
                        <a href="myinfo.html" id="profileLink" style="display: none;">내 정보 페이지</a>
                        <a href="home.html" id="logoutLink" style="display: none;">로그아웃</a>
                    </div>
                </div>
            </nav>
        </div>
    </div>

    <!-- 메인 콘텐츠: 가게 등록 폼 -->
    <div class="main-content">
        <h2>가게 등록</h2>
        <img th:src="@{/images/main_logo.png}" alt="Main Logo">
        <p class="description">새로운 가게를 등록하여 맛집 정보를 공유하세요.</p>
        <form action="store_register.php" method="post" enctype="multipart/form-data" onsubmit="return validateForm()">
            <!-- 가게 이름 -->
            <div class="form-group">
                <label for="store_name">가게 이름</label>
                <input type="text" id="store_name" name="store_name" placeholder="가게 이름을 입력해 주세요." required>
            </div>
            <!-- 가게 주소 및 우편번호 검색 -->
            <div class="form-group">
                <label for="store_address">가게 주소</label>
                <input type="text" id="store_address" name="store_address" placeholder="가게 주소를 입력해 주세요." required readonly>
                <button type="button" class="postcode-button" onclick="openPostcode()">우편번호 찾기</button>
            </div>
            <!-- 우편번호 및 도로명 주소 -->
            <div class="form-group">
                <label for="postcode">우편번호</label>
                <input type="text" id="postcode" name="postcode" placeholder="우편번호" readonly>
            </div>
            <div class="form-group">
                <label for="road_address">도로명 주소</label>
                <input type="text" id="road_address" name="road_address" placeholder="도로명 주소" readonly>
            </div>
            <div class="form-group">
                <label for="detailAddress">상세주소</label>
                <input type="text" id="detailAddress" name="detailAddress" placeholder="상세주소" disabled>
            </div>
            <div class="form-group">
                <label for="extraAddress">참고항목</label>
                <input type="text" id="extraAddress" name="extraAddress" placeholder="참고항목" disabled>
            </div>
            <!-- 카카오맵 표시 영역 -->
            <div id="map" style="width:100%;height:350px;margin-bottom:20px;"></div>
            <!-- 카테고리 선택 -->
            <div class="form-group">
                <label for="category_id">카테고리</label>
                <select id="category_id" name="category_id" required>
                    <option value="">카테고리를 선택하세요.</option>
                    <option value="1">한식</option>
                    <option value="2">일식</option>
                    <option value="3">중식</option>
                    <option value="4">양식</option>
                    <option value="5">카페</option>
                    <option value="6">디저트</option>
                </select>
            </div>
            <!-- 가게 사진 업로드 및 미리보기 -->
            <div class="form-group">
                <label>가게 사진</label>
                <button type="button" class="custom-file-button" id="store_photo_button">가게 사진 선택</button>
                <span class="file-name" id="store_photo_filename">선택된 파일 없음</span>
                <input type="file" id="store_photo" name="store_photo" accept="image/*" class="hidden-file-input" onchange="previewStorePhoto(this)">
                <img id="store_photo_preview" src="#" alt="가게 사진 미리보기" style="display: none; width: 150px; height: auto; margin-top: 10px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            <!-- 영업 시간 -->
            <div class="time-group">
                <div class="form-group">
                    <label for="opening_time">영업 시작 시간</label>
                    <input type="time" id="opening_time" name="opening_time">
                </div>
                <div class="form-group">
                    <label for="closing_time">영업 종료 시간</label>
                    <input type="time" id="closing_time" name="closing_time">
                </div>
            </div>
            <!-- 홈페이지 정보 -->
            <div class="form-group">
                <label for="website_info">홈페이지 정보</label>
                <input type="text" id="website_info" name="website_info" placeholder="홈페이지 URL을 입력해 주세요.">
            </div>
            <!-- 전화번호 -->
            <div class="form-group">
                <label for="phone_number">전화번호</label>
                <input type="text" id="phone_number" name="phone_number" placeholder="전화번호를 입력해 주세요.">
            </div>
            <!-- 가게 설명 -->
            <div class="form-group">
                <label for="store_description">가게 설명</label>
                <textarea id="store_description" name="store_description" placeholder="가게에 대한 설명을 입력해 주세요." required></textarea>
            </div>
            <!-- 메뉴 섹션 (초기 로드 시 숨김) -->
            <div class="form-group">
                <label>메뉴</label>
                <div id="menus">
                    <!-- 메뉴 섹션이 여기에 동적으로 추가됩니다 -->
                </div>
                <button type="button" class="add-menu-button" onclick="addMenu()">+ 메뉴 추가</button>
            </div>
            <!-- 버튼 컨테이너 -->
            <div class="button-container">
                <input type="submit" value="등록" onclick="alert('가게가 성공적으로 등록되었습니다!')">
                <button type="button" class="cancel-button" onclick="location.href='home.html'">취소</button>
            </div>
        </form>
    </div>

    <!-- 푸터 섹션 -->
    <footer>
        <div class="footer-container">
            <!-- 회사 소개 -->
            <div class="footer-section">
                <h4>프로젝트 소개</h4>
                <p>먹코살코은 최고의 맛집 제공하기 위해 최선을 다하고 있습니다.</p>
            </div>
            <!-- 빠른 링크 -->
            <div class="footer-section">
                <h4>빠른 링크</h4>
                <ul>
                    <li><a href="home.html">홈</a></li>
                    <li><a href="intro.html">소개</a></li>
                    <li><a href="service.html">서비스</a></li>
                    <li><a href="contact.html">문의</a></li>
                </ul>
            </div>
            <!-- 연락처 -->
            <div class="footer-section">
                <h4>연락처</h4>
                <ul>
                    <li>전화: 02-112-7777</li>
                    <li>이메일: admin@taste_police.com</li>
                    <li>주소: 서울특별시 송파구 중대로 135, 서관 12층</li>
                </ul>
            </div>
            <!-- 소셜 미디어 -->
            <div class="footer-section">
                <h4>소셜 미디어</h4>
                <div class="social-icons">
                    <a href="https://www.facebook.com/yourprofile" aria-label="페이스북">
                        <img th:src="@{/images/facebook_icon.png}" alt="Facebook">
                    </a>
                    <a href="https://www.twitter.com/yourprofile" aria-label="트위터">
                        <img th:src="@{/images/twitter_icon.png}" alt="Twitter">
                    </a>
                    <a href="https://www.instagram.com/yourprofile" aria-label="인스타그램">
                        <img th:src="@{/images/instagram_icon.png}" alt="Instagram">
                    </a>
                </div>
            </div>
        </div>
        <!-- 푸터 하단 정보 -->
        <div class="footer-bottom">
            &copy; 2024 먹코살코. All rights reserved.
        </div>
    </footer>

    <!-- 스크립트 -->
    <script>
    // 이전 가게 이름을 저장할 변수
    let previousStoreName = '';

    // 가게 이름 입력 필드에 포커스가 갈 때 이전 값을 저장
    document.getElementById('store_name').addEventListener('focus', function() {
        previousStoreName = this.value;
    });

    // 가게 사진 버튼 클릭 시 파일 입력 트리거
    document.getElementById('store_photo_button').addEventListener('click', function() {
        document.getElementById('store_photo').click();
    });

    // 동적으로 추가되는 메뉴 사진 버튼 트리거
    document.addEventListener('click', function(event) {
        if (event.target && event.target.classList.contains('menu_photo_button')) {
            // 해당 버튼의 다음 형제 요소인 파일 입력을 클릭
            const fileInput = event.target.nextElementSibling.nextElementSibling;
            if (fileInput) {
                fileInput.click();
            }
        }
    });

    // 가게 사진 미리보기 및 파일명 표시 함수
    function previewStorePhoto(input) {
        const preview = document.getElementById('store_photo_preview');
        const filenameSpan = document.getElementById('store_photo_filename');
        const file = input.files[0];

        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
            }
            reader.readAsDataURL(file);
            filenameSpan.textContent = file.name;
        } else {
            preview.src = '#';
            preview.style.display = 'none';
            filenameSpan.textContent = '선택된 파일 없음';
        }
    }

    // 메뉴 사진 미리보기 및 파일명 표시 함수
    function previewMenuPhoto(input) {
        const preview = input.nextElementSibling; // input 다음에 위치한 img 태그
        const filenameSpan = input.parentElement.querySelector('.file-name');
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
            }
            reader.readAsDataURL(input.files[0]);
            filenameSpan.textContent = input.files[0].name;
        } else {
            preview.src = '#';
            preview.style.display = 'none';
            filenameSpan.textContent = '선택된 파일 없음';
        }
    }

    // 메뉴 추가 함수
    function addMenu() {
        const menus = document.getElementById('menus');

        const menuSection = document.createElement('div');
        menuSection.className = 'menu-section';
        menuSection.innerHTML = `
            <button type="button" class="remove-menu" onclick="removeMenu(this)">×</button>
            <div class="form-group">
                <label for="menu_name">메뉴 이름</label>
                <input type="text" name="menu_name[]" placeholder="메뉴 이름을 입력해 주세요." required>
            </div>
            <div class="form-group">
                <label for="menu_price">가격</label>
                <input type="text" name="menu_price[]" placeholder="가격을 입력해 주세요." required>
            </div>
            <div class="form-group">
                <label>메뉴 사진</label>
                <button type="button" class="custom-file-button menu_photo_button">메뉴 사진 선택</button>
                <span class="file-name">선택된 파일 없음</span>
                <input type="file" name="menu_photo[]" accept="image/*" class="hidden-file-input menu_photo_input" onchange="previewMenuPhoto(this)">
                <img class="menu_photo_preview" src="#" alt="메뉴 사진 미리보기" style="display: none; width: 100px; height: auto; margin-top: 10px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
        `;
        menus.appendChild(menuSection);
    }

    // 메뉴 제거 함수
    function removeMenu(button) {
        const menuSection = button.parentElement;
        menuSection.remove();
    }

    // 폼 유효성 검사 함수
    function validateForm() {
        const storeName = document.getElementById('store_name').value.trim();
        const storeAddress = document.getElementById('store_address').value.trim();
        const categoryId = document.getElementById('category_id').value;

        if (storeName === '' || storeAddress === '' || categoryId === '') {
            alert('가게 이름, 가게 주소, 카테고리를 모두 입력해 주세요.');
            return false;
        }

        // 추가적으로 필요한 검증 사항이 있다면 여기에 추가
        // 예: 전화번호 형식, 홈페이지 URL 형식 등

        return true;
    }

    // 카카오맵 API 초기화
    let map;
    let geocoder;
    let marker;
    let infowindow;

    function initMap() {
        map = new kakao.maps.Map(document.getElementById('map'), {
            center: new kakao.maps.LatLng(37.5665, 126.9780), // 기본 서울 중심
            level: 3
        });

        geocoder = new kakao.maps.services.Geocoder();
    }

    // 주소 검색 함수 (별도로 사용 가능)
    function searchAddress() {
        const address = document.getElementById('store_address').value.trim();
        const storeName = document.getElementById('store_name').value.trim();

        if (address === '') {
            alert('주소를 입력해 주세요.');
            return;
        }

        if (storeName === '') {
            alert('가게 이름을 먼저 입력해 주세요.');
            return;
        }

        if (!geocoder) {
            alert('지도 초기화가 완료되지 않았습니다. 잠시 후 다시 시도해 주세요.');
            return;
        }

        geocoder.addressSearch(address, function(result, status) {
            if (status === kakao.maps.services.Status.OK) {
                const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                map.setCenter(coords);

                // 기존 마커 제거
                if (marker) {
                    marker.setMap(null);
                }

                // 마커 표시
                marker = new kakao.maps.Marker({
                    map: map,
                    position: coords
                });

                // 인포윈도우로 가게 이름 표시
                if (infowindow) {
                    infowindow.close();
                }

                infowindow = new kakao.maps.InfoWindow({
                    content: `<div style="width:150px;text-align:center;padding:6px 0;">${storeName}</div>`
                });
                infowindow.open(map, marker);
            } else {
                alert('주소 검색에 실패했습니다. 정확한 주소를 입력해 주세요.');
            }
        });
    }

    // 우편번호 찾기 팝업 열기
    function openPostcode() {
        new daum.Postcode({
            oncomplete: function(data) {
                // 선택한 주소 정보를 해당 필드에 입력
                document.getElementById('postcode').value = data.zonecode;
                document.getElementById('road_address').value = data.roadAddress;

                // 가게 주소 필드에 도로명 주소를 입력
                document.getElementById('store_address').value = data.roadAddress;

                // 상세주소 및 참고항목 필드 활성화
                document.getElementById('detailAddress').disabled = false;
                document.getElementById('extraAddress').disabled = false;

                // 지도를 업데이트하여 마커를 표시
                const address = data.roadAddress;
                const storeName = document.getElementById('store_name').value.trim();

                if (address !== '' && storeName !== '') {
                    geocoder.addressSearch(address, function(result, status) {
                        if (status === kakao.maps.services.Status.OK) {
                            const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                            map.setCenter(coords);

                            // 기존 마커 제거
                            if (marker) {
                                marker.setMap(null);
                            }

                            // 마커 표시
                            marker = new kakao.maps.Marker({
                                map: map,
                                position: coords
                            });

                            // 인포윈도우로 가게 이름 표시
                            if (infowindow) {
                                infowindow.close();
                            }

                            infowindow = new kakao.maps.InfoWindow({
                                content: `<div style="width:150px;text-align:center;padding:6px 0;">${storeName}</div>`
                            });
                            infowindow.open(map, marker);
                        } else {
                            alert('주소 검색에 실패했습니다. 정확한 주소를 입력해 주세요.');
                        }
                    });
                }
            }
        }).open();
    }

    // 가게 이름 변경 시 경고 메시지 및 주소 필드 초기화
    document.getElementById('store_name').addEventListener('change', function() {
        const roadAddress = document.getElementById('road_address').value.trim();
        if (roadAddress !== '') {
            const confirmChange = confirm('가게이름 변경 시 도로명 주소를 다시 입력해야 합니다. 그래도 변경하시겠습니까?');
            if (confirmChange) {
                // 도로명 주소, 상세주소, 참고항목 필드 비우기
                document.getElementById('road_address').value = '';
                document.getElementById('store_address').value = '';
                document.getElementById('postcode').value = '';
                document.getElementById('detailAddress').value = '';
                document.getElementById('extraAddress').value = '';

                // 상세주소 및 참고항목 필드 비활성화
                document.getElementById('detailAddress').disabled = true;
                document.getElementById('extraAddress').disabled = true;

                // 지도 초기화
                map.setCenter(new kakao.maps.LatLng(37.5665, 126.9780));
                if (marker) {
                    marker.setMap(null);
                }
                if (infowindow) {
                    infowindow.close();
                }

                // 가게 사진 미리보기 초기화
                const preview = document.getElementById('store_photo_preview');
                preview.src = '#';
                preview.style.display = 'none';

                // 파일명 초기화
                const filenameSpan = document.getElementById('store_photo_filename');
                filenameSpan.textContent = '선택된 파일 없음';

                // 모든 메뉴 사진 미리보기 및 파일명 초기화
                const menuPreviews = document.querySelectorAll('.menu_photo_preview');
                const menuFilenames = document.querySelectorAll('.menu-section .file-name');
                menuPreviews.forEach(function(img) {
                    img.src = '#';
                    img.style.display = 'none';
                });
                menuFilenames.forEach(function(span) {
                    span.textContent = '선택된 파일 없음';
                });
            } else {
                // 사용자가 변경을 취소했을 때 이전 값으로 복원
                this.value = previousStoreName;
            }
        }
    });

    // 페이지 로드 시 맵 초기화
    window.onload = initMap;
    </script>
</body>
</html>
